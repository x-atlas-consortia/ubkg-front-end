<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UBKGBox</title>
    <link rel="icon" type="image/x-icon" href="images/android-chrome-192x192.png">
    <!-- Bootstrap styles -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script>
        // Utility to get cookie value by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // Utility to set cookie
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days*24*60*60*1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/; SameSite=Strict";
        }

        window.addEventListener('DOMContentLoaded', function() {
            // If cookie already set with UMLS key, hide the modal and proceed
            if (!getCookie('umls-key')) {
                // Show modal to get UMLS key
                let modalHtml = `
                    <div class="modal fade" id="umlsKeyModal" tabindex="-1" aria-labelledby="umlsKeyModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <form id="umlsKeyForm">
                          <div class="modal-header">
                            <h5 class="modal-title" id="umlsKeyModalLabel">Enter a UMLS API Key</h5>
                          </div>
                          <div class="modal-body">
                            <input class="form-control" id="umls-key-modal" name="umls-key-modal" type="password" required placeholder="UMLS API Key">
                            <div id="umls-key-error" class="text-danger mt-2" style="display:none;">API Key is required.</div>
                          </div>
                          <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save Key</button>
                          </div>
                          </form>
                        </div>
                      </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                var umlsKeyModal = new bootstrap.Modal(document.getElementById('umlsKeyModal'), {});
                umlsKeyModal.show();

                document.getElementById('umlsKeyForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    var key = document.getElementById('umls-key-modal').value.trim();
                    if (!key) {
                        document.getElementById('umls-key-error').style.display = 'block';
                        return;
                    }
                    setCookie('umls-key', key);
                    umlsKeyModal.hide();
                });
            }
        });
    </script>
</head>
<body>
<div class="position-relative d-flex mb-3" style="margin-left:0;">
    <img src="images/ubkgbox.jpg" width="320" height="300" class="imgubkgbox d-block" style="margin-left:0;">
    <figcaption
        class="position-absolute"
        style="left: 320px; top: 50%; transform: translateY(-50%); font-size:50px; white-space:nowrap;">
        UBKGBox
    </figcaption>
</div>
<br>
<br>
<form id="api_form" target="_blank" class="m-3">
    <h3>UBKG API</h3>
    <div class="row align-items-center g-2">
        <div class="col-auto">
            <label for="endpoint" class="col-form-label mb-0">
                Optional endpoint
            </label>
        </div>
        <div class="col-md-5 col-sm-6">
            <input type="text" class="form-control"
                id="endpoint"
                name="endpoint"
                placeholder="e.g., codes/SNOMEDCT_US:79962008/concepts"
                aria-label="Enter optional endpoint">
        </div>
    </div>
    <div class="row mt-2">
        <div class="col-md-2">
            <button type="submit"
                formaction="/api"
                class="btn btn-primary w-100"
                id="ubkgapi_button"
                aria-label="UBKG API">
                Launch UBKG API
            </button>
        </div>
    </div>
</form>

<form action="/neo4j/browser/" method="get" target="_blank" class="m-3">
    <h3>neo4j</h3>
    <div class="row align-items-center g-2">
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100" id="neo4j_button">
                Launch neo4j browser
            </button>
        </div>
        <div class="col-md-7 col-sm-8">
            <i>In the neo4j browser login, enter <strong>neo4j://neo4j.ubkg.com:7001</strong> for <strong>Connect URL</strong>; <strong>neo4j</strong> for <strong>Username</strong>; and the password for the neo4j user in <strong>Password</strong>.</i>
        </div>
    </div>
</form>

<form action="/guesdt" method="get" target="_blank" class="m-3">
    <h3>Guesdt</h3>
    <div class="row align-items-center g-2">
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100" id="guesdt_button" value="Guesdt" aria-label="Launch Guesdt">
                Launch Guesdt
            </button>
        </div>
    </div>
</form>
<footer>
    <div class="m-3">
        <a rel='license' href='http://creativecommons.org/licenses/by/4.0/'><img alt='Creative Commons License' style='border-width:0' src='https://i.creativecommons.org/l/by/4.0/80x15.png' /></a><span xmlns:dct='http://purl.org/dc/terms/' property='dct:title'>  <strong>UBKGBox</strong>, built by the Department of Biomedical Informatics, University of Pittsburgh School of Medicine, </span> is licensed under a <a rel='license' href='http://creativecommons.org/licenses/by/4.0/'>Creative Commons Attribution 4.0 International License</a>.
    </div>
</footer>
<!-- Bootstrap JS (for modal) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script></body>
</html>