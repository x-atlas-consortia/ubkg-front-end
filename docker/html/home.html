<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UBKGBox</title>
    <link rel="icon" type="image/x-icon" href="images/android-chrome-192x192.png">
    <!-- Bootstrap styles -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        figcaption {
            text-align: center;
            font-size: 40px;
        }
        .imgubkgbox {
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
    </style>
    <script>
        // Utility to get cookie value by name
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // Utility to set cookie
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days*24*60*60*1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/; SameSite=Strict";
        }

        window.addEventListener('DOMContentLoaded', function() {
            // If cookie already set, hide the modal and proceed
            if (!getCookie('umls-key')) {
                // Show modal to get UMLS key
                let modalHtml = `
                    <div class="modal fade" id="umlsKeyModal" tabindex="-1" aria-labelledby="umlsKeyModalLabel" aria-hidden="true">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <form id="umlsKeyForm">
                          <div class="modal-header">
                            <h5 class="modal-title" id="umlsKeyModalLabel">Enter a UMLS API Key</h5>
                          </div>
                          <div class="modal-body">
                            <input class="form-control" id="umls-key-modal" name="umls-key-modal" type="password" required placeholder="UMLS API Key">
                            <div id="umls-key-error" class="text-danger mt-2" style="display:none;">API Key is required.</div>
                          </div>
                          <div class="modal-footer">
                            <button type="submit" class="btn btn-primary">Save Key</button>
                          </div>
                          </form>
                        </div>
                      </div>
                    </div>
                `;
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                var umlsKeyModal = new bootstrap.Modal(document.getElementById('umlsKeyModal'), {});
                umlsKeyModal.show();

                document.getElementById('umlsKeyForm').addEventListener('submit', function(e) {
                    e.preventDefault();
                    var key = document.getElementById('umls-key-modal').value.trim();
                    if (!key) {
                        document.getElementById('umls-key-error').style.display = 'block';
                        return;
                    }
                    setCookie('umls-key', key);
                    umlsKeyModal.hide();
                });
            }
        });
    </script>
</head>
<body>
<div class="mb-3 m-3">
        <img src="images/ubkgbox.jpg" width="320" height="300" class="imgubkgbox">
        <figcaption>UBKGBox</figcaption>
    </div>
<form id="ubkgbox_form" target="_blank">
    <br>
    <h2 class="m-3"> UBKG Clients</h2>
    <div class="form-group row m-3">
        <h4>API</h4>
        <label for="endpoint" class="col-sm-2 col-form-label">Optional endpoint</label>
        <div class="col-sm-4">
            <input type="text" class="form-control" id="endpoint" name="endpoint" placeholder = "e.g., codes/SNOMEDCT_US:79962008/concepts"aria-label="Enter optional endpoint" rows="2">
        </div>
        <div class="col-sm-4">
             <input type="submit" formaction="/api" class="btn btn-primary" id="ubkgapi_button" value="UBKG API" aria-label="UBKG API">
        </div>
    </div>
    <div class="form-group row m-3">
        <h4>Browser applications</h4>
        <div class="col-sm-2">
             <input type="submit" class="btn btn-primary" formaction="/neo4j/browser/?connecturl=http://neo4j.ubkg.com:7100" id="neo4j_button" value="neo4j" aria-label="Launch neo4j">
        </div>
        <div class="col-sm-2">
             <input type="submit" class="btn btn-primary" formaction="/guesdt" id="guesdt_button" value="Guesdt" aria-label="Launch Guesdt">
        </div>
    </div>
</form>
<!-- Bootstrap JS (for modal) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script></body>
</html>